#!/bin/zsh -e

if [[ -n $1 ]]; then
  # å¼•æ•°ã‚ã‚Šï¼šæ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
  NEW_BRANCH=$1
  echo "âš’ï¸ Creating new branch: [$NEW_BRANCH]"

  if ! git branch | grep -q "^[* ] ${NEW_BRANCH}$"; then
    git checkout -b "$NEW_BRANCH"
    git commit --allow-empty -m "$NEW_BRANCH"
  fi
else
  # å¼•æ•°ãªã—ï¼šç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½¿ã†
  NEW_BRANCH=$(git rev-parse --abbrev-ref @)
  echo "ğŸ‘€ Using current branch: [$NEW_BRANCH]"
fi

# ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥
git branch -r | grep -q "origin/${NEW_BRANCH}$" || git push -u origin "$NEW_BRANCH"
echo 'âœ… Success! Created remote branch'

# PRã‚’ä½œæˆ
if ! gh pr create -d; then
  echo 'âŒ Failed to create draft PR'
  exit 1
fi

echo 'âœ… Success! Created draft PR'
