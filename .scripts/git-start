#!/bin/zsh -e

NEW_BRANCH=$1;

if [[ -z $1  ]]; then
  echo ' Use this branch as feature branch.';
  BASE_BRANCH=$(git show-branch | grep '!' | awk -F'[]~^[]' '{print $2}');
  NEW_BRANCH=$(git rev-parse --abbrev-ref @);
else
  BASE_BRANCH=$(git rev-parse --abbrev-ref @);
fi;

if [[ $BASE_BRANCH = "main" ]] || [[ $BASE_BRANCH = "master" ]]; then
  echo "  üî•ATTENTION!! you are trying to make branch from [$BASE_BRANCH]üî•";
fi;

read "yn?  You want to make Base Branch: [$BASE_BRANCH] -> New Branch: [$NEW_BRANCH]? (y/n)  ";

case $yn in
  [yY]* ) echo "  üÜó Let's Start!";;
  * ) exit 1;;
esac;

if ! git branch | grep -q "^[* ] ${NEW_BRANCH}$"; then
  git checkout -b "$NEW_BRANCH";
  git commit --allow-empty -m "$NEW_BRANCH";
  # echo "make new branch:$NEW_BRANCH"
fi;

git branch -r | grep -q "origin/${NEW_BRANCH}$" || git push -u origin "$NEW_BRANCH";
# git branch -r | grep "origin/${NEW_BRANCH}$" || echo "push branch";
echo '‚úÖ Success! Created remote branch';

if ! gh pr create -d; then
  echo '‚ùå Failed to create draft PR';
  exit 1;
fi;

echo '‚úÖ Success! Created draft PR';
